---
title: "Reproducible Report Template - Basic"
author: "Student/s SID"
subtitle: "Project 1"
date: "University of Sydney | Data1001 | August 2018"
# You can change the title, subtitle, author etc.
# if you do not want a subtitle, author, or date just delete or comment # the the line!
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    #This will allow you to insert icons in your document, thanks to [Font Awesome](http://fontawesome.io).
    #You will find an examples below.
    # If you are knitting your document but not connected to the internet, place a "#" in front of the css line above with the font-awesome.min.css line to comment it out. This will let you knit the document in draft form until you connect again and knit the final. Note that when you do this some elements will be missing from the knitted slides. 
    toc: true
    #This adds a Table of Contents (toc).
    toc_depth: 3
    #This controls the number of subheadings included in the toc.
    toc_float: true
    #This allows toc to update relative to your location as you scroll down the html page.
    code_folding: hide
    #code_folding can be changed to "hide"" if you want the all your code to be collapsed when you open the document
    
    # More information: http://rmarkdown.rstudio.com/html_document_format.html
---

<br>

# Executive Summary
- The aim of this report is to find out what kind of correlations are between weather and alcohol sales in Sydney.
- The main discoveries are ...

<br>

<br>

# Full Report

## Initial Data Analysis (IDA)

RStudio has many data sets already loaded in. The example below uses preloaded data direct from RStudio example dataset: mtcars.

Read about the [mtcars data set](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html).

In the rmd file, you will see how you can load your own dataset from either 1) an online source using a URL or 2) a local file on your own computer.

```{r}

# LOAD DATA
library(ggplot2)
library(tidyr)
data = read.csv("data/ProcessedData.csv")


# Quick look at top 5 rows of data
head(data)

## Size of data
# For the mtcars dataset, there are 32 rows (the types of cars) and 11 variables (properties of the cars).
dim(data)

## R's classification of data
class(data)

## R's classification of variables
str(data)
#sapply(mtcars, class)
```

Summary:

- The data came from two different sources. The weather data came in two different data sets from the [Bureau of Meteorology] (http://www.bom.gov.au/climate/data/) website and the sale data of alcoholic beverages came from a local store in Sydney. We are using data from both resources and combining the into one big dataset. a
- The data is/is not valid because 
  The data is valid because we are getting 
- Possible issues include ...
- Each row represents ...
- Each column represents ...

<br>

##IDA
Complexity of data:
 We are looking at a dataset with len(names())

## Research Question 1

How does the maximum temperature affect the consumer decision when purcahsing alcohol?

Insert text and analysis.

Lets start at looking at how much a person spends in the store on average. The number we see inside each bar represents the number of transactions for that temperature category and the line in each bar represent the median of money spent. As we can see from the chart, people seem to spend more money in milder temperature (15 - 40 degrees) but in more extreme temperatures (10 - 15 and 40 - 45 degrees) people tend to buy less alcohol. We can also observe that people tend to spend more money when the temperature is between 35 and 40 degrees. 



```{r}
#The temperature is a quantitative variable. We start by changing it to a qualitative one using ranges that cover 5 degrees Celcius
temp = data$Maximum.temperature..Degree.C.
data$tempGroups = cut(temp, c(10,15,20,25,30,35,40,45))

#Transaction sizes for each temperature range
meanPerPerson = aggregate(data$Total ~ data$tempGroups, data, mean)
medPerPerson = aggregate(data$Total ~ data$tempGroups, data, median)
transactions = merge(x = meanPerPerson, y = medPerPerson, by='data$tempGroups')
names(transactions) = c('Temperature', 'Mean_total', 'Median_total')
print(transactions)

Fre <- as.data.frame(table(data$tempGroups))
colnames(Fre)[1] <- "tempGroups" 
Fre$lab <- as.character(Fre$Freq)


#Barplot for average money spent with median lines
ggplot(transactions, aes(Temperature, Mean_total), label = Fre$Freq) + geom_bar(stat="identity", position = "dodge", fill = "#FF6666") + ggtitle("Average how much each person spends (in dollars) for different temperature") + ylab("Mean") + theme_bw() + theme(plot.title = element_text(hjust = 0.5)) + geom_errorbar(data=transactions, aes(Temperature, ymax = Median_total, ymin = Median_total), size=1, linetype = "solid", inherit.aes = F, width = 0.9) + geom_text(aes(label = Fre$Freq), position = position_dodge(width = 0.9), vjust = 1.5) + scale_x_discrete(labels = c('10 - 15','15 - 20','20 - 25', '25 - 30', '30 - 35', '35 - 40', '40 - 45'))

 #Barplot showing only median
 #ggplot(transactions, aes(Temperature, Median_total)) + geom_bar(stat="identity", position = "dodge", fill = "#56B4E9") + ggtitle("Median how much each person spends (in dollars) for different temperature") + ylab("Median") + theme_bw() + theme(plot.title = element_text(hjust = 0.5))
 
 #ggplot(data, aes(Maximum.temperature..Degree.C., median(Total)), group = 1) + geom_boxplot() + coord_flip()

 #Number of transactions per temperature range
 #barplot(table(data$tempGroups))

```
Lets look at what an average day looks like in total sales for each temperature range. This seems to back up what we where saying before. That in extreme temperature (10 - 15 and 40 - 45 degrees) people seem to buy less alcohol while in milder temperatures people seem to buy alot. We also see the spike again when the temperature is between 35 - 40 degrees. 

```{r}
 
 #Total money spent for each temperature range
 totalPerDay = aggregate(data$Total ~ data$tempGroups, data, sum)
 nrOfDaysPerTemp = aggregate(data$Date ~ data$tempGroups, data, function(x) length(unique(x)))
 totals = merge(x = totalPerDay, y = nrOfDaysPerTemp, by='data$tempGroups')
 names(totals) = c('Temperature', 'Total', 'NrOfDays')
 totals['meanPerDay'] = round(totals$Total / totals$NrOfDays, 1)
 
 ggplot(totals, aes(Temperature, meanPerDay)) + geom_bar(stat="identity", position = "dodge") + geom_bar(stat="identity", position = "dodge", fill = "#56B4E9") + ggtitle("Average how much is spent in one day (in dollars) for different temperature") + ylab("Mean") + theme_bw() + theme(plot.title = element_text(hjust = 0.5)) + scale_x_discrete(labels = c('10 - 15','15 - 20','20 - 25', '25 - 30', '30 - 35', '35 - 40', '40 - 45'))
 
```

Summary: 
Looking at the values of the median and mean purchase transactions we see that there is not much change in consumer behaviour over the temperature ranges 15-35 degrees. However the more extreme temperature values have more of an effect. During the coldest times (10-15 degrees) there is a definate drop in amount of money spent per purchase. During the very hottest periods 40-45 degrees there is also a massive drop in amount spent on each transaction. However it is worth noting that there were very few transactions during that time. Another very interesting spike in sales occured at the 35-40 temperature range. This could be because people drink more alcohol, however these would be regular temperatures during Christamas time when people are on vacation and drink more alcohol in general.

## Research Question 2
How does rainfall affect the consumer decision when purchasing alcohol?


Insert text and analysis.

There are a few days for which we do not have rain data so we start by removing those rows. We then take a better look at the rain data Let's start by taking a better look at the rainfall data
```{r}
rainData = data %>% drop_na(Rainfall.amount..millimetres.)
print(paste('Number of rows with missing values for rainfall: ', nrow(data)-nrow(rainData)))
rain = rainData$Rainfall.amount..millimetres.
print(paste('Maximum rainfall', max(rain)))
print(paste('Minimum rainfall', min(rain)))
print(paste('Mean rainfall', mean(rain)))
print(paste('Median rainfall', median(rain)))
```

```{r}
#We start by changing the rainfall from a quantitative variable to a qualitative one
rainData$rainGroups = cut(rain, c(0,5,15,40,70))

#Transaction sizes for each temperature range
meanPerPerson = aggregate(rainData$Total ~ rainData$rainGroups, rainData, mean)
medPerPerson = aggregate(rainData$Total ~ rainData$rainGroups, data, median)
transactions = merge(x = meanPerPerson, y = medPerPerson, by='rainData$rainGroups')
names(transactions) = c('Rainfall', 'Mean_total', 'Median_total')
print(transactions)

 ggplot(transactions, aes(Rainfall, Mean_total)) + geom_bar(stat="identity", position = "dodge") 
 ggplot(transactions, aes(Rainfall, Median_total)) + geom_bar(stat="identity", position = "dodge")

 #Number of transactions for each rainfall range
 barplot(table(rainData$rainGroups))
 
 
 #Total money spent for each temperature range
 totalPerDay = aggregate(rainData$Total ~ rainData$rainGroups, rainData, sum)
 nrOfDaysPerRain = aggregate(rainData$Date ~ rainData$rainGroups, rainData, function(x) length(unique(x)))
 totals = merge(x = totalPerDay, y = nrOfDaysPerRain, by='rainData$rainGroups')
 names(totals) = c('Rainfall', 'Total', 'NrOfDays')
 totals['meanPerDay'] = round(totals$Total / totals$NrOfDays, 1)
 
 ggplot(totals, aes(Rainfall, meanPerDay)) + geom_bar(stat="identity", position = "dodge")

```



Insert text and analysis. 

Summary: 

## Research Question 3

How does the time of year affect the consumer decision when purchasing alcohol?

Other possible research questions: 
What time of day do people buy their alcohol?

Insert text and analysis. 

Summary: 

<br>

## Research Question 4

TODO:

# Conclusions

Insert text.

<br>

# References

Style: APA 

<br>

# Personal reflection on group work

- The way I contributed was
- What I learnt about group work was ... 

<br>


# Beyond the Basics - extending your abilities with RMarkdown
This quick reference guide will cover some basic RMarkdown for use in your projects. 

<br>

## Lists

Here is a basic list:

- To do 1

- To do 2

- To do 3

<br>

## Links

Here is a link to interesting web page:

[Interesting Web Page](https://www.ted.com/topics/visualizations)

<br>


## Tables

Here is a simple table.

| Tables        | Are           | Cool  |
|---------------|:-------------:|------:|
| col 3 is      | right-aligned | $1600 |
| col 2 is      | centered      |   $12 |
| zebra stripes | are neat      |    $1 |

<br> 

## Images

Here is am image. It has not been adjusted in the rmd file, so represents the true size of the original image. This image is sourced directly from an online url. 

To learn more about adding images directly from your own computer, see the comments in this rmd file. 

![](https://petcube.com/blog/content/images/2017/08/kitten-supplies-cover.jpg)

<!-- Begin comment

Use the line below if you are sourcing an image from your own computer. For this line to run correctly, you would need to have an image called 'kitten.jpg' in a folder called 'figure' which is in the same folder as this rmd file.

![](figure/kitten.jpg)

-----------------------------
**Making image adjustments**
With some changes to the rmarkdown in the rmd file, you can also to reduce the image size by, say, 50% and make it left aligned:
<div align="left">
<img src="figure/kitten.jpg" width="50%" height="50%">
</div>
-----------------------------

Give it a try! Find a picture of a kitten online, save it to your computer as described above and see what happens. 

end comment --->

<br>
Image source: https://petcube.com/blog/10-all-important-kitten-supplies-infographic/

<br>

## Videos

Below you will find a video embedded into your RMarkdown file. 
Change the YouTube link in the rmd file to get a different video.

<div style="max-width:640"><div style="position:relative;height:0;padding-bottom:56.25%"><iframe src="https://www.youtube.com/embed/a6KGPBflhiM" width="560" height="315" style="position:absolute;left:0;top:0;width:100%;height:100%" frameborder="0" scrolling="no" allowfullscreen></iframe></div></div>

<br>

## LaTeX

You can even use LaTeX in an RMarkdown document!

For example, how could you work out $\sum_{i=1}^{5} x_{i}^3$?

<br>

## R Code

Here is an R code chunk:

Try the following commands in R.
```{r,eval=F}
1+ exp(3) + sin(0.5)
x=c(1,2,3)
x^2
sum(x)
```

Here is some in-line code `in-line code`. You can put any R code here for display, e.g. `sum(x)`

<br>

# RMarkdown Resources
Check out the resources below for more information on RMarkdown. 

 <i class="fa fa-link"></i>[How to use R Markdown](https://www.oreilly.com/learning/easy-reproducible-reports-with-r?utm_medium=social&utm_source=twitter.com&utm_campaign=lgen&utm_content=data+webcast+ki&cmp=tw-data-na-article-lgen_tw_webcast_ki)
 
<i class="fa fa-link"></i>[Mastering Markdown](https://guides.github.com/features/mastering-markdown/)

<br>